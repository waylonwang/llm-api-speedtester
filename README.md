# LLM API 速度与延迟测试工具

[English version](readme_en.md)

这是一个用于测试大语言模型 (LLM) API 调用速度和性能的工具。它可以测量不同输入和输出 Token 组合下的吞吐量 (tokens/sec) 和首个 Token 的平均响应延迟。

![工具截图1](placeholder-1.png)
![工具截图2](placeholder-2.png)

## ✨ 功能特性

*   **API 端点自定义**: 支持测试任意兼容 OpenAI 流式接口的 LLM API 端点。
*   **模型名称指定**: 可以输入要测试的具体模型名称。
*   **API Token (可选)**: 支持需要身份验证的 API。
*   **供应商管理**: 集中管理多个 API 供应商的基础 URL 和默认 Token，方便快速配置。
*   **API 管理**: 支持按供应商分组管理 API，支持标签筛选和批量添加。
*   **批量测试**: 支持同时测试多个 API，可选择并行或串行执行，快速对比性能。
*   **性能对比**: 可视化对比多个 API 的吞吐量和延迟表现。
*   **历史记录**: 自动保存测试历史，支持查看、对比和删除历史记录。
*   **截图功能**: 一键截图保存测试结果。
*   **性能矩阵**:
    *   **吞吐量 (Tokens/sec)**: 以表格形式展示不同输入 Token 数和输出 Token 数组合下的吞吐量，数值越高越好。
    *   **首个 Token 平均等待时间 (秒)**: 展示相应组合下的 p99 延迟，数值越低越好。
*   **动态颜色高亮**: 测试结果会根据性能好坏进行颜色编码，方便快速识别瓶颈。
*   **纯前端逻辑**: 所有测试均在用户的浏览器端发起，服务器仅用于托管该单页面应用。

## 🚀 如何使用

该工具设计为单文件部署，将所有 HTML, CSS, 和 JavaScript 嵌入其中。

**开始测试：**

1.  启动服务器：
    ```bash
    npm start
    # 或
    node server.js
    ```
2.  打开浏览器访问 `http://localhost:3000`。
3.  在"供应商管理"页面添加 API 供应商（可选，用于快速配置）。
4.  在"API 管理"页面添加要测试的 API。
5.  进入"快速测试"、"批量测试"或"性能对比"页面开始测试。

## 🛠️ 技术细节

*   **前端**: HTML, CSS, 和纯 JavaScript。
*   **后端**: Node.js + 原生 HTTP 模块。
*   **数据存储**: JSON 文件存储（`data.json`）。
*   **API 调用**: 使用浏览器 `fetch` API 以流式 (stream) 方式调用 LLM API。
*   **性能指标**:
    *   **首个 Token 延迟**: 从发送请求到接收到第一个数据块的时间。为降低波动，会对每个单元格进行多次测试并取平均值。
    *   **吞吐量**: (近似输出 Token 数) / (总响应时间)。输出 Token 数通过计算接收到的字符数并除以一个平均值（例如 4 字符/Token）来近似。
*   **Token 近似**: 由于前端无法直接访问特定模型的 Tokenizer，输入 Token 数是通过生成特定长度的占位符文本来模拟的，输出 Token 数是基于实际接收到的字符数进行估算的。

## 📝 注意事项与限制

*   **Token 近似精度**: Token 计数是近似值，实际的 Token 数可能因模型和文本内容而异。
*   **网络波动**: 测试结果受用户当前网络环境影响。建议多次测试或在不同网络下测试以获得更全面的了解。
*   **浏览器限制**: 大量并发请求或长时间测试可能受浏览器资源限制。
*   **API 速率限制**: 请注意不要超过目标 LLM API 的速率限制，否则可能导致测试失败或账户问题。
*   **CORS**: 工具直接从浏览器向目标 API 发起请求。如果目标 API 没有正确配置 CORS (Cross-Origin Resource Sharing) 策略以允许来自你的域名的请求，测试将无法进行。大多数公共 LLM API 已经配置了较为宽松的 CORS 策略。

## 💡 未来可能的改进

*   [ ] 支持导入/导出测试配置和结果。
*   [ ] 更精确的 Token 计算（如果可能集成轻量级 Tokenizer）。
*   [x] "分享结果" 功能的后端实现。
*   [ ] 可视化图表展示历史测试数据。

## 🙏 致谢

本项目基于原版 [LLM API Speed Tester](https://github.com/JohnMing143/llm-api-speedtester) 进行扩展开发。原版是一个部署在 Cloudflare Pages 上的轻量级测试工具，感谢原作者的开源贡献。

## 🤝 贡献

欢迎提出问题 (Issues) 或提交合并请求 (Pull Requests)！

## 📄 开源许可

本项目采用 [MIT License](LICENSE) 开源。